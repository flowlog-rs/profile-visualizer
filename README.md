# FlowLog Profile Visualizer

A small CLI that converts **FlowLog profiling outputs** into a single, self-contained HTML report for interactive exploration.

This tool is intended to be used alongside FlowLog's profiler: FlowLog emits a time log (`time.tsv`), a memory log (`memory.tsv`), and a physical-operator-to-logical-node mapping (`ops.json`), and this CLI renders them into a browsable visualization.

## What it does

Given FlowLog's profiling artifacts, the CLI:

- Parses **FlowLog's** time log (`time.tsv`), memory log (`memory.tsv`), and operator mapping (`ops.json`).
- Maps operator addresses to logical nodes (inputs, strata, rules operators, runtime operators, inspection).
- Aggregates per-node and per-operator:
  - **Time**: activations and total active time (ms)
  - **Memory**: batched_in, merges, merge_in, merge_out, dropped
- Produces a self-contained `report.html` with:
  - A **node list** grouped by block (input / strata / inspect) and, within strata, grouped by **rule vs. runtime**
  - An interactive **DAG view** (pan/zoom + click-to-select) with a **Time / Memory toggle** to switch color modes
  - A per-node **operator table** with both time and memory columns for detailed drill-down
  - A **top-10 list** showing hottest nodes by time or memory

## Inputs (generated by FlowLog)

This tool consumes files **generated by FlowLog**:

- `time.tsv`: FlowLog-generated time log (tab-separated): operator activations and active time per operator address.
- `memory.tsv`: FlowLog-generated memory log (tab-separated): batched_in, merges, merge_in, merge_out, dropped per operator address.
- `ops.json`: FlowLog-generated operator mapping JSON (logical nodes, blocks/strata, rule stage/runtime tags, operator addresses, DAG edges).

> Note: `ops.json` provides the "semantic structure" (nodes and edges). `time.tsv` and `memory.tsv` provide the runtime measurements. The report combines all three.

## Usage

Build and run directly:

```bash
cargo run --release -- --ops examples/ops.json --time examples/time.tsv --memory examples/memory.tsv --out report.html
```

Then open `report.html` in your browser.

### CLI flags

| Flag | Short | Description |
|------|-------|-------------|
| `--ops <PATH>` | `-p` | Path to FlowLog operator mapping (`ops.json`). |
| `--time <PATH>` | `-t` | Path to FlowLog time log (`time.tsv`). |
| `--memory <PATH>` | `-m` | Path to FlowLog memory log (`memory.tsv`). |
| `--out <PATH>` | `-o` | Output HTML file to write (e.g., `report.html`). |

All four flags are required.

## Output

- `report.html`: a standalone HTML file (no external assets) that you can share or archive alongside the profiling run.

## Typical workflow

1. Run your FlowLog program with profiling enabled to produce `time.tsv`, `memory.tsv`, and `ops.json`.
2. Run **FlowLog Profile Viz** to generate `report.html`.
3. Use the report to identify hot nodes/operators and understand how work is distributed across components -- switch between **Time** and **Memory** views using the toggle in the report.
